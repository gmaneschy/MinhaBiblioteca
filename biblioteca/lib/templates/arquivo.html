<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Biblioteca</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 30px;
}

th, td {
  border: 1px solid #ccc;
  padding: 10px;
  text-align: left;
}

th {
  background-color: #f4f4f4;
}

.btn {
  background-color: #71bf47;
  color: white;
  border: none;
  padding: 8px 14px;
  margin: 2px;
  border-radius: 5px;
  cursor: pointer;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  text-decoration: none;

}

.btn:hover {
  background-color: #578c3b;
}

.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.modal-conteudo {
  background: white;
  border: 3px solid #71bf47;
  padding: 20px;
  margin: 10% auto;
  width: 350px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

.modal-conteudo label {
  display: block;
  margin-top: 10px;
}

.modal-conteudo input {
  width: 100%;
  padding: 6px;
  margin-top: 5px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.modal-conteudo button {
  margin-top: 15px;
}
</style>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/arquivo.css' %}">
</head>
<body>
    <div class="arquivo">
        <h1>Minha Biblioteca</h1>
        <div style="max-height: 70vh; overflow-y: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="position: sticky; top: 0; background-color: #84917d; z-index: 1;">
              <tr>
                <th style="position: sticky; top: 0; background: #84917d; z-index: 1;">Título</th>
                <th style="position: sticky; top: 0; background: #84917d; z-index: 1;">Autor</th>
                <th style="position: sticky; top: 0; background: #84917d; z-index: 1;">Editora</th>
                <th style="position: sticky; top: 0; background: #84917d; z-index: 1;">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for livro in livros %}
              <tr>
                <td>{{ livro.titulo }}</td>
                <td>{{ livro.autor }}</td>
                <td>{{ livro.editora }}</td>
                <td>
                    <a class="btn" onclick="abrirModal({{ livro.id }}, '{{ livro.titulo|escapejs }}', '{{ livro.autor|escapejs }}', '{{ livro.editora|escapejs }}')">Editar</a>
                    <a href="{% url 'deletar_livro' livro.id %}" class="btn" onclick="return confirm('Tem certeza que deseja excluir?');">Excluir</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
        </table>
        </div>
    </div>


  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-conteudo">
      <form method="POST" action="{% url 'editar_livro' 0 %}" id="form-editar" onsubmit="return validarFormulario();">
        {% csrf_token %}
        <input type="hidden" name="id" id="modal-id">
        <label for="modal-titulo">Título:</label>
        <input type="text" name="titulo" id="modal-titulo">
        <label for="modal-autor">Autor:</label>
        <input type="text" name="autor" id="modal-autor">
        <label for="modal-editora">Editora:</label>
        <input type="text" name="editora" id="modal-editora">
        <button type="submit" class="btn">Salvar</button>
        <button type="button" class="btn" onclick="fecharModal()">Cancelar</button>
      </form>
    </div>
  </div>

  <script>
    function abrirModal(id, titulo, autor, editora) {
      document.getElementById('modal').style.display = 'block';
      document.getElementById('modal-id').value = id;
      document.getElementById('modal-titulo').value = titulo;
      document.getElementById('modal-autor').value = autor;
      document.getElementById('modal-editora').value = editora;

      const form = document.getElementById('form-editar');
      form.action = `/editar/${id}/`;
    }

    function fecharModal() {
      document.getElementById('modal').style.display = 'none';
    }
    window.onclick = function(event) {
      const modal = document.getElementById('modal');
      if (event.target === modal) {
        fecharModal();
      }
    }

    function validarFormulario() {
      const titulo = document.getElementById('modal-titulo').value.trim();
      const autor = document.getElementById('modal-autor').value.trim();
      const editora = document.getElementById('modal-editora').value.trim();

      if (!titulo || !autor || !editora) {
        alert('Por favor, preencha todos os campos.');
        return false;
      }
      return true;
    }


  </script>
</body>

</html>