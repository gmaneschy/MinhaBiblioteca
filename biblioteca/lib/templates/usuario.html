{% extends 'navbar.html' %}
{% load static %}
{% block title %}Usuário{% endblock %}
{% block content %}
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
<link rel="stylesheet" href="{% static 'css/usuario.css' %}">

<div class="container">
<h1 contenteditable="true" spellcheck="false" id="nome-biblioteca">{{ biblioteca.nome }}</h1>
<div class="usuario">

  <!-- Seção do Perfil -->
  <div class="perfil-usuario">
    <div class="descricao-biblioteca">
      <h2>{{ user.username }}</h2>
      <p>{{ user.profile.descricao|default:"Nenhuma descrição ainda." }}</p>
    </div>
  </div>

  <!-- Estatísticas da Biblioteca -->
  <div class="estatisticas-biblioteca">
    <h3>Estatísticas da Biblioteca</h3>
    <table class="tabela-estatisticas">
      <thead>
        <tr>
          <th>Total de Livros</th>
          <th>Total de Páginas</th>
          <th>Preço Total</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ total_livros }}</td>
          <td>{{ total_paginas }}</td>
          <td>{{ preco_total }} R$</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
</div>

<script>
document.getElementById('nome-biblioteca').addEventListener('blur', function() {
    updateBibliotecaName(this.innerText);
});

document.getElementById('nome-biblioteca').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        this.blur();
    }
});

function updateBibliotecaName(newName) {
    fetch(window.location.href, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: 'nome_biblioteca=' + encodeURIComponent(newName)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status !== 'success') {
            alert('Erro ao atualizar o nome da biblioteca');
        }
    });
}

document.getElementById('nome-biblioteca').addEventListener('blur', function() {
  const novoNome = this.innerText.trim();
  if (!novoNome) {
      alert('Nome não pode ser vazio!');
      this.innerText = "{{ biblioteca.nome }}";  // Restaura o valor anterior
      return;
  }
  updateBibliotecaName(novoNome);
});
</script>

{% endblock %}